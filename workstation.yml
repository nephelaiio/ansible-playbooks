---
- name: Configure workstation

  hosts: workstation

  vars:

    nfs_exports:
      - "/home {{ nets.private.network }}/{{ nets.private.netmask }}(rw,sync,no_root_squash)"

  roles:

    - nephelaiio.tree
    - nephelaiio.vim
    - nephelaiio.devtools
    - nephelaiio.rbenv
    - nephelaiio.pyenv
    - nephelaiio.tmux
    - nephelaiio.vagrant
    - nephelaiio.i3
    - nephelaiio.docker
    - nephelaiio.nfs


- name: Configure satellite client

  hosts: satellite

  environment: "{{ proxy_env | default({}) }}"

  vars:

    resolv_nameservers: "{{ servers.recursors }}"
    resolv_search:
      - "{{ dns.zones.home.name }}"
    resolv_options:
      - timeout:1

  roles:

    - nephelaiio.plugins
    - nephelaiio.docker

  tasks:

    - name: install development tools
      include_role:
        name: nephelaiio.devtools
      become: yes

    - name: install nfs package
      package:
        name: nfs-common
      become: yes

    - name: mount home
      mount:
        path: /home
        src: "{{ hostvars['cerberus']['ansible_br1']['ipv4']['address'] }}:/home"
        fstype: nfs
        opts: rw,soft,timeo=5,intr
        state: mounted
      become: yes
