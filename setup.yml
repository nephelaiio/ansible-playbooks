---
- name: Manage user environment

  hosts: localhost

  connection: local

  gather_facts: no

  tasks:

    - name: create vault directory
      file:
        name: "{{ lookup('env', 'HOME') }}/.ansible_vault"

    - name: manage vault identity list global variables
      blockinfile:
        path: "{{ lookup('env', 'HOME') }}/.profile"
        marker: "#-- ANSIBLE MANAGED BLOCK: ansible-vault --#"
        backup: yes
        block: "{{ lookup('file', 'bin/env') }}"


- name: Install project prerequisites

  hosts: localhost

  connection: local

  tasks:

    - name: install package requirements
      package:
        name:
          - libcurl4-openssl-dev
          - libxml2-dev
      become: yes
      when: false

    - name: install pip requirements
      command: pip install -r requirements.txt

    - name: install galaxy roles
      command: ansible-galaxy install -r roles/requirements.yml --force

    - name: install galaxy collections
      command: ansible-galaxy collection install -r role/requirements.yml --force
      when: false
