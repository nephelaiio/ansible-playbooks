---
- name: Manage user environment

  hosts: localhost

  connection: local

  gather_facts: no

  tasks:

    - name: create vault directory
      file:
        name: "{{ lookup('env', 'HOME') }}/{{ ansible_vault_identity_dir }}"

    - name: manage vault identity list global variables
      blockinfile:
        path: "{{ lookup('env', 'HOME') }}/.bashrc"
        marker: "#-- ANSIBLE MANAGED BLOCK: ansible-vault --#"
        backup: yes
        block: "{{ lookup('file', 'bin/load_vaults.sh') }}"


- name: Install project prerequisites

  hosts: localhost

  gather_facts: no

  tasks:

    - name: install requirements
      command: pip install -r requirements.txt

    - name: install galaxy roles
      command: ansible-galaxy install -r roles/requirements.yml -p roles/ --force

    - name: install galaxy collections
      command: ansible-galaxy collection install -r collections/requirements.yml --force
