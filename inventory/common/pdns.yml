---
pdns_mysql_root_pass: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  61323735396561396338663331343138633261663665373561346531613934373530633761613262
  3330313534393730313039336232386131343036623735330a616436396437376630313831393762
  63626362646639363037363933383531656235663263613036666130623131333662646138303536
  3539363463366238370a333435613664333934316564663566653936616661316337363932396435
  31623932636437396466353863616636323039363531366439623737396530393464
pdns_mysql_user: foreman
pdns_mysql_pass: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  62356665306363363932656435353535623461303536346333613731373236356332663965653565
  3839333766333038363832623736376539356164313633390a383263346164353132353631326637
  33643863653631663634353831653833663064306562656531666530373363633837343365616431
  3630633265313830300a386366353232646164346365336533323735366434396131353563626338
  37303865643532393132316630616531323363353531353762373739356231623031

dns_ttl: 3600
dns_master: domainmaster.nephelai.io

dns:
  search_domains:
    - "{{ base_domain }}"
  zones:
    home:
      name: "{{ base_domain }}"
      hostmaster: "master@{{ base_domain }}"
      ns: "{{ groups['pdns'] }}"
      records: "{{ nets.home.reservations.values() | list | map('merge_dicts', {'type': 'A'}) | list }}"
      cnames:
        - host: "assistant.{{ base_domain }}"
          cname: rpig.home.nephelai.io
      foreman_locations:
        - "{{ foreman_locations.home.name }}"
      foreman_organizations:
        - "{{ foreman_organizations.nephelai.name }}"
    emoh:
      name: "{{ nets.home.zone }}"
      hostmaster: master@home.nephelai.io
      ns: "{{ groups['pdns'] }}"
      records: []
      cnames: []
      foreman_locations:
        - "{{ foreman_locations.home.name }}"
      foreman_organizations:
        - "{{ foreman_organizations.nephelai.name }}"
    tnemeganam:
      name: "{{ nets.management.zone }}"
      hostmaster: master@home.nephelai.io
      ns: "{{ groups['pdns'] }}"
      records: []
      cnames: []
      foreman_locations:
        - "{{ foreman_locations.home.name }}"
      foreman_organizations:
        - "{{ foreman_organizations.nephelai.name }}"

pdns:
  config:
    api: yes
    api-key: "{{ pdns_api_key }}"
    webserver: yes
    webserver-address: 127.0.0.1
    webserver-port: "{{ pdns_api_port }}"
    webserver-allow-from: 127.0.0.1
    dnsupdate: no
    master: yes
    setuid: pdns
    setgid: pdns
    slave: no
    local-address: "{{ ansible_host }}:53"
    security-poll-suffix: ''
    default-soa-name: "{{ groups['pdns'] | first | map(attribute='inventory_hostname') }}"
    default-soa-mail: "{{ dns_master }}"
    default-ttl: "{{ dns_ttl }}"
  backends:
    gpgsql:
      user: "{{ pdns_mysql_user }}"
      host: 127.0.0.1
      password: "{{ pdns_mysql_pass }}"
      dbname: pdns
  domains: "{{ dns.zones.values() | list }}"
