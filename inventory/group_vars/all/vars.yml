---
timezone: America/Costa_Rica

nets:
  home:
    network: 192.168.0.0
    netmask: 255.255.255.0
    router: 192.168.0.1
    zone: 0.168.192.in-addr.arpa
    pools:
      - range: '192.168.0.65 192.168.0.127'
    reservations:
      - host: cerberus.home.nephelai.io
        ip-address: 192.168.0.11
        hw-address: ae:77:35:db:a0:17
      - host: rpia.home.nephelai.io
        ip-address: 192.168.0.10
        hw-address: b8:27:eb:10:54:87
      - host: rpib.home.nephelai.io
        ip-address: 192.168.0.9
        hw-address: b8:27:eb:40:6b:19
      - host: rpic.home.nephelai.io
        ip-address: 192.168.0.8
        hw-address: b8:27:eb:68:b9:3a

servers:
  dhcp:
    - 192.168.0.10
    - 192.168.0.9
  recursors:
    - 192.168.0.10
    - 192.168.0.9
  dns:
    - 192.168.0.8

kvm:
  bridge_config: "/etc/sysctl.d/99-bridge.conf"
  defaults:
    vm:
      state: present  # | recreate | absent
      memory: 2048
      cpu: 1
      image: xenial
      autostart: True
      size: 10G
      pool: default
      nic:
        name: enp0s3
        type: bridge
        net: br0
        prefix: "{{ nets.home.router | ipaddr('prefix') }}"
        gateway: "{{ nets.home.router | ipaddr('address') }}"
        nameservers: "{{ servers.recursors }}"
    pool:
      state: present
      autostart: True
  vms:
    kvma:
      cpu: 2
      memory: 4096
      name: kvma
      state: recreate
      nic:
        hw-address: 52:54:00:94:37:21
        ip-address: 192.168.0.20
        prefix: 255.255.255.0
        gateway: 192.168.0.1
        host: kvma.home.nephelai.io
    kvmb:
      cpu: 2
      memory: 4096
      name: kvmb
      state: recreate
      nic:
        hw-address: 52:54:00:94:37:22
        ip-address: 192.168.0.21
        prefix: 255.255.255.0
        gateway: 192.168.0.1
        host: kvmb.home.nephelai.io
    kvmc:
      cpu: 2
      memory: 4096
      name: kvmc
      state: recreate
      nic:
        hw-address: 52:54:00:94:37:23
        ip-address: 192.168.0.22
        prefix: 255.255.255.0
        gateway: 192.168.0.1
        host: kvmc.home.nephelai.io
    kvmd:
      cpu: 2
      memory: 4096
      name: kvmd
      state: absent
      nic:
        hw-address: 52:54:00:94:37:24
        ip-address: 192.168.0.23
        prefix: 255.255.255.0
        gateway: 192.168.0.1
        host: kvmd.home.nephelai.io
    kvme:
      cpu: 2
      memory: 4096
      name: kvme
      state: absent
      nic:
        hw-address: 52:54:00:94:37:25
        ip-address: 192.168.0.24
        prefix: 255.255.255.0
        gateway: 192.168.0.1
        host: kvme.home.nephelai.io
  pools:
    default:
      path: /var/lib/libvirt/images
  images:
    xenial:
      src: https://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-disk1.img
      pool: default
      format: qcow2
      checksum: sha256:6d3dd685ac6eeca8a0b75cc47add6e4e6a433c13a80712b4bc4b22480542fdf4
    centos:
      src: https://cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2.xz
      pool: default
      format: qcow2
      checksum: sha256:e139c5b7a799f3f1d48aa897f1b8165c18ef6eeb212cadf138d32537600c6005

dns:
  zones:
    home:
      name: home.nephelai.io
      hostmaster: master@home.nephelai.io
      mx:
        - name: rpia.home.nephelai.io
      ns:
        - name: rpic.home.nephelai.io
      records: "{{ nets.home.reservations | list + (kvm.vms | map('extract', kvm.vms) | map (attribute='nic') | list ) }}"
      cnames:
        unifi.home.nephelai.io: rpib.home.nephelai.io
        home.nephelai.io: rpia.home.nephelai.io
    emoh:
      name: "{{ nets.home.zone }}"
      hostmaster: master@home.nephelai.io
      ns:
        - name: rpic.home.nephelai.io
      mx: []
      records: "{{ (nets.home.reservations | list + (kvm.vms | map('extract', kvm.vms) | map (attribute='nic') | list )) | map('reverse_record') | list }}"
      cnames: []

pdns:
  config:
    dnsupdate: yes
    allow-dnsupdate-from: "{{ servers.dhcp | ipaddr('host') | join(' ') + ' 127.0.0.1/32' }}"
    master: yes
    setuid: pdns
    setgid: pdns
    slave: no
    local-address: "{{ ansible_default_ipv4.address }}:53"
    security-poll-suffix: ''
  backends:
    gmysql:
      user: pdns
      host: 127.0.0.1
      password: "{{ passwords.mysql.pdns }}"
      dbname: pdns
  domains: "{{ dns.zones.values() }}"

rabbitmq:
  management: false
  sensu:
    vhost: /sensu
    user: sensu
    password: "{{ passwords.rabbitmq.sensu }}"

sensu:
  user: sensu
  env: /opt/sensu

zookeeper:
  port: '2181'

jupyter:
  user: root
  group: root
  port: 443
  password: "{{ jupyter_password }}"
  notebookdir: /home/ubuntu/notebooks
  confdir: /home/ubuntu/.jupyter
  certfile: fullchain.pem
  keyfile: privkey.pem
  exec_args: "--certfile {{ jupyter_confdir }}/{{ jupyter_certfile }} --keyfile {{ jupyter_confdir }}/{{ jupyter_keyfile }}"
  region: us-west-2
  availability_zone: b
  state: stopped  # one of [ absent, running, stopped ]
  route53_zone: nephelai.io.
  instance_type: p2.xlarge
  client_token: "{{ 'test04' | to_uuid }}"
  ami_id: ami-e9038d89
  ami_user: ubuntu
  key: teodoro.cook@gmail.com
  pause_seconds: 30

kolla:
  release: 5.0.0.0rc1

awx:
  release: 1.0.0

openshift:
  relase: release-3.6

kubespray:
  release: v2.2.0

foreman:
  release: 1.15
