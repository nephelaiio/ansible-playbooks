---
foreman_repositories_version: 1.23
foreman_installer_options: "{{ foreman_installer_options_base + foreman_installer_options_trusted_hosts }}"

foreman_network_dict: "{{ nets.values() | list_to_dict('network', remove_key=False) }}" 
foreman_proxy_iface: "{{ ansible_default_ipv4.interface }}"
foreman_proxy_network: "{{ foreman_network_dict[ansible_default_ipv4.network] }}"

foreman_installer_options_base:
  - "--no-enable-foreman"
  - "--no-enable-puppet"
  - "--enable-foreman-proxy"
  - "--enable-foreman-proxy-plugin-discovery"
  - "--enable-foreman-proxy-plugin-dns-powerdns"
  - "--foreman-proxy-bind-host 0.0.0.0"
  - "--foreman-proxy-trusted-hosts localhost"
  - "--foreman-proxy-puppet false"
  - "--foreman-proxy-foreman-base-url {{ foreman_url }}"
  - "--foreman-proxy-register-in-foreman true"
  - "--foreman-proxy-dns pr"
  - "--foreman-proxy-bmc true"
  - "--foreman-proxy-dhcp true"
  - "--foreman-proxy-dhcp-interface {{ foreman_proxy_iface }}"
  - "--foreman-proxy-dhcp-network {{ foreman_proxy_network.network }}"
  - "--foreman-proxy-dhcp-netmask {{ foreman_proxy_network.netmask }}"
  - "--foreman-proxy-dhcp-gateway {{ foreman_proxy_network.router }}"
  - "--foreman-proxy-dhcp-nameservers {{ foreman_proxy_network.ns | join(',') }}"
  - "--foreman-proxy-dhcp-range '{{ foreman_proxy_network.dhcp }}'"
  - "--foreman-proxy-dns true"
  - "--foreman-proxy-dns-provider powerdns"
  - "--foreman-proxy-plugin-dns-powerdns-rest-api-key {{ pdns_api_key }}"
  - "--foreman-proxy-plugin-dns-powerdns-rest-url {{ pdns_url }}/api/v1/servers/localhost"
  - "--foreman-proxy-plugin-discovery-install-images true"
  - "--foreman-proxy-http true"
  - "--foreman-proxy-logs true"
  - "--foreman-proxy-puppet false"
  - "--foreman-proxy-tftp true"
  - "--foreman-proxy-oauth-consumer-key {{ foreman_oauth_consumer_key }}"
  - "--foreman-proxy-oauth-consumer-secret {{ foreman_oauth_consumer_secret }}"

foreman_installer_options_trusted_hosts: "{{ foreman_proxy_trusted_hosts | map('map_format', '--foreman-proxy-trusted-hosts %s') | list }}"

foreman_api_user: "{{ foreman_admin_user }}"
foreman_api_pass: "{{ foreman_admin_pass }}"
foreman_proxy_trusted_hosts: "{{ groups['foreman_app'] }}"
