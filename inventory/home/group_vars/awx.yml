---
awx_release: 9.1.1
upgrade_reboot_host: no
nginx_proxy_url: "{{ awx_url }}"
nginx_proxy_pdns_url: "{{ pdns_url }}"
nginx_proxy_pdns_api_key: "{{ pdns_api_key }}"
nginx_proxy_upstream_group: awx_app
nginx_proxy_aws_accesskey_id: "{{ aws_access_key_id }}"
nginx_proxy_aws_accesskey_secret: "{{ aws_secret_access_key }}"

awx_admin_user: root
awx_admin_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  36643134363535366335666366376138393430613534386438323733653332656361633738666361
  3062323863636234666432353333626266626233393634370a353839313463303737616337306666
  37313139636564396365626430356233363532646163663831303638356434363565383631373536
  6131623262393537330a316336303966353830376665326635646133353735323031346264323861
  33336265366430613534623331303938386661376536623766626266343331396230

awx_secret_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  64646561306463313539613061303533326333313530623630333863666363306330386261333864
  3661303864646635376539626137626238646362656664330a383861313333643633396234656235
  34626662653830333733323362353332316535356363653938313162643063663761633931636634
  3936633035303662330a633133326432653964373764623737376566653934613439386262366236
  39383436623863386234373936313537303632616235623334633732656466303335

awx_pg_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  39333163363630343037306631383564353336306232613166613232396164323837363065613364
  6461353565376137623535323237363061626432646434640a316339656232623135376332306564
  65633637383538323962656131396465636662623136653239383730626131323936386137646131
  6235326238646331300a316632336435653830663331663330346335393932316563393761343161
  33323062656434616438353932636265306338343461303063373634653136623031376363663238
  3536303732623634383438303730656665363337306566363665

awx_vault_home_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  32393061366263313662333266393236343432313034323330353433316262356361333534663532
  3266396339306139316234326461303062383662303565660a636565396332356137623464313936
  62353731666138363337313665623234663335356361313161306564373236303635653965633932
  6130303936643061300a313731653631363863643664613861383761316132376431303634646261
  36663730303861323763383531316638636264386434623361356634666430363635

awx_vault_common_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63376163366262633734383233306263303430653134366234366163353739376332323161646438
  3933616266383966323562333764323637303831333564330a663733353230656436303336633237
  33623264616337393335643339653364656138383331393061336661363063653463613765633661
  3731613463323337330a333666613763353961343730656630303861653035623334303962663239
  36326138613635643466633534646138666561323431396234646339303432656335

awx_rabbitmq_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  38306539636638336163656566623563333264323934636533653063613934636461346632346237
  3666353138616438653531323231393839633765663333350a363066346564336334646434376365
  39383831393665636637626265336330373561326638656636646531313337343932646433393262
  3864303433343033330a633834613961303738376336616232303930313866643866363034363037
  34663436646338636133323065303638373763333564333666613963636131346533343066616138
  6232616635396362646132373961626134356333626132333965

awx_github_user: teddyphreak
awx_github_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  34353339653230393633346633636565653934613138303634353861396462353138663663626537
  6363663733353433616331656534353438363639306532330a386438396634306166363461396133
  66643336323332303937616635363831393765396435646165636464326362666235333663323432
  3964356362343231390a633235643064386466653431643061303739633932386336336366313330
  3230
awx_machine_user: "{{ users.root.username }}"
awx_machine_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  31333030386130383636326564346632626232303436623632643739386531396130383165393732
  3730306637376237336536613862383139306232396339300a356632326531376466356561663735
  66306366613830626434616366313364653561373437303933326438653863643835373339633764
  6163316234396163350a316461326535626364346236646632343631663033303539626633376465
  61383838386333373163373737613665646365666364306131343835373931626261613230326565
  38383139383230353862306433643038643862636132313038386264333431616564613962333265
  61333633336139386163346636363437326438636361656634336465336664353136353866623232
  61666364633034356437393731626466383338333530356431343735393437366138356234643364
  36333439373965396235643136396166373963643231626430313937303239326137623663343436
  33666139663330336263336638313733393162386234316466663866663533313737346232356664
  39383431626337653831323933323861313333396434353433333436323661376430333166353539
  35316330313036303164356638383366306139396234366534633633666638336638386530306635
  63323264646663346263396536666661386664343532383330303439623263396166383230613164
  37393132396463383932663662336234346137396539333630626334393834366538386564373065
  64336232353066643931313063346531383962626434666366313036383734303032343863316234
  66633937366635303636623366326637653366343365666166613563346362346665633562316363
  30353232613739323237623234623833306365376537653438623733363938616532396131333466
  38306166313961363039353334333338613531353130326539613662666132343064353633626239
  63343963386239353765666263613135313465623562353132663362663534336262623735366337
  64633538383865666435396662383131313235633839633165313936366537303136386530643361
  32366264366564336139643332356430356462386131303562643231346330336565666332643835
  30626230323935303364623433353266616630373665306361366339633137366539646631643265
  35346463636163353865306239666433653432666162666237653438386138616338626530653766
  30393230646233643037363864613437626566626537613662366535313439396565386138366334
  32306663353038616161303263643832386332623365396139616136333762663237656465626462
  33623837323339663632613866333661613065343538326134623937666334333363616234383735
  33643266326535366164353330396366613439373665663164633033386639623165643330303262
  38663433346633396633656135326238323032356361623665646439303635393336613965333265
  35376635323565646230623939306131306666316165396162376534643464663633386330393163
  62353765346530316330626663633965633861646463333237656333376639306165336666396363
  34356165623034333666643233643937326436326131623637653139643333646532393933346163
  39366161623233313430313765626138363930633539663939333934663135623035623638333339
  63373264636639323766626663346432316538366665643230323638383831343961363034623838
  61653639316334313966353833363165356532626262393965353138313030356565393562653765
  65343630316633633638643661356166303836656338653163633734316533313863366539323861
  31633232656466663035613430343732353132623934626361306666366537313962636531653934
  35353661346631353639303037336138356265343965363734353536396164616463323963356230
  30666361616162393832646434353933666563636332386639613363346336643138306534663262
  35393265343734613764663631343731393835636364383733333236333434616637313436373762
  62623137353531333437316430643336356337666132333236346162393362373864356332343063
  62333761636234303363653666303164376537343035373562353635643062393563663237636265
  65353764323435313230623037646436383563633564326637356233306361646535333662643462
  31363565336230613133303032326465623738396639396635343038353339303236653036616532
  38636537316630396130326362346430353064333036646563343437663433653261386565373933
  62373963376438383264613739323166353665643231376464633738396634643936383936326130
  66613836376231306334623038613830653364383065653733636133323062636165376433636437
  33323962356365623734393034623332393938333334646135613631383936663232343063356632
  35643233356662646564646563346162393539383361376333303737653735653237623832313239
  32356161353965363165383033363633333133396431646235313036613936656265353866373336
  63363565326563376236626663373264376130653230653634303163386666333531363461396130
  64366435353336666466383735323761626136613262333630343734643436396638633863336561
  33643839323531343762373463623563323932363930316235643365333861393336343731616663
  65363362643165393461303166306330363363363065303934646432393565363461343838393436
  34633239303532323338616663646330316431656337656664333433663434303062383165336235
  35313335373762383165393134666339653461373738303038306662396137386438336636303230
  64633566393564333965376338636130643239626161626630303265353334333735356165616265
  38643434303262623262373762376135613933303166646662363635323863356661383138663130
  61643435366237653634313365333733373434633262663464613730656362383433626366613162
  38636362346133346631643031653531333236313363653762646634346538613036626233643836
  33323538396336623161633662386137383963343233303939643961626262336137623839376234
  30373737333430306237386633363165346631383565323434323364653938393166373435653939
  33656539333135363134646231323330313633326338643038616361613030346231363234363862
  64306239643431303632323435643635613739303832386262373761313536613439346431313139
  63636237333432653430353863336330386262643037623530623833393664323531373362643065
  64333666343438636331663538326462353332363961613235613163356163656130396633333938
  34653136656634313363633761373634366462653234633164303063613830326636326364353165
  36343330653161323562323331643663636639633832646638616262396130343363396238663165
  38336339623566653535393038356566656161363539643666663439613139346239623839363636
  61633666636533313734623766383362376535653532613936626438303434333333396432333361
  38303566396238316565616265333536613438306634376363663934663331373666373539656265
  33343961316564656563643130346161396332356132373764616263663231663234326436313234
  62363737623261663032663036656362633735633632646461633666353630313162373634646534
  33616435356337343063396130326331626338333038323831393333316230323330666337316432
  32323062333131343036633837643433663431613532656361356236643130666233666130343638
  66643231313233376231366635383263386361636639646430363735326538383539333234653436
  63663832306131623031393635666265336439623638633931613730666364646531653935616531
  33363836373734303432633162313030366634613031643238343432383530353935646265333364
  34323065666361303836653738623534313438313961333935623963336339343163613136643730
  32346339653461363232393863313134336664303337383661323962336635323238636236626532
  33623333366266616534326462653138313237663864393665353366623933616661353334663066
  62383762613563623038653862636566643435313131366535336434336532353162373364306238
  36343631353437303363396162326235636335383031303336323065393563633933323137656230
  39643061366365353131393664626663313165313862386164613238643666646336383438336133
  64323334333737363164343539363132396232663337373361623730323532666633623561393136
  65376237623861643239356239356234373364613831636634376463303238663464343339646234
  34656234613464633930363539333533646566643661356130376438336333363231313066633836
  34613761323538366230333131666437326439633733333862323637366661326363616639663639
  63373831666332353230

awx_ldap_bind_user: awx
awx_ldap_bind_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  61333264633166343063336237643637643863366462643838346566343632373465303361653238
  6435353637323066623032393237346265396232646135330a376337393162653964643535303231
  33386638613830393566646339363535353531373239633462643139646665343365306137313864
  3735316239323964360a616165626165333561643335313434303433316631653238303964366462
  38303534393566663737336434383932656162373561356137306234303133393138

ipa_users:
- user_name: "{{ awx_ldap_bind_user }}"
  first_name: AWX
  last_name: Bind
  pass: "{{ awx_ldap_bind_pass }}"
  update_password: always
awx_settings:
  AUTH_LDAP_SERVER_URI: "{{ (groups['ipa_server'] + groups['ipa_replica']) | map('map_format',
    'ldap://%s:389') | join(' ') }}"
  AUTH_LDAP_GROUP_TYPE: GroupOfNamesType
  AUTH_LDAP_REQUIRE_GROUP: 'cn={{ awx_ldap_connect_group.name }},cn=groups,cn=accounts,{{
    awx_ldap_domain_dn }}'
  AUTH_LDAP_TEAM_MAP: "{{ awx_ldap_team_map }}"
  AUTH_LDAP_GROUP_TYPE_PARAMS: {}
  AUTH_LDAP_GROUP_SEARCH:
  - 'cn=groups,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(objectClass=ipausergroup)'
  AUTH_LDAP_USER_SEARCH:
  - 'cn=users,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(uid=%(user)s)'
  AUTH_LDAP_USER_ATTR_MAP:
    first_name: 'givenName'
    last_name: 'sn'
    email: 'mail'
  AUTH_LDAP_BIND_DN: "uid={{ awx_ldap_bind_user }},cn=users,cn=accounts,{{ awx_ldap_domain_dn
    }}"
  AUTH_LDAP_BIND_PASSWORD: "{{ awx_ldap_bind_pass }}"
  REMOTE_HOST_HEADERS:
  - HTTP_X_FORWARDED_FOR
  TOWER_URL_BASE: "{{ awx_url }}"

awx_teams:
- name: home_users
  organization: home

awx_users:
- first_name: CI
  last_name: Integration
  username: "{{ awx_ci_user }}"
  password: "{{ awx_ci_pass }}"
  email: "{{ awx_ci_email }}"
  superuser: yes

awx_templates:
- name: Demo Job Template
  state: absent
- name: awx.configure
  job_type: run
  project: awx
  inventory: home
  playbook: configure.yml
  skip_tags:
  - awx_skip
  ask_skip_tags: yes
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: awx.proxy
  job_type: run
  project: inventory
  inventory: home
  playbook: awx/proxy.yml
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.recursors
  job_type: run
  project: pdns
  playbook: recursor.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.servers
  job_type: run
  project: pdns
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.records
  job_type: run
  project: pdns
  playbook: records.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.register
  job_type: run
  project: pdns
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: traefik.restart
  job_type: run
  project: inventory
  playbook: traefik/restart.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: upgrade
  job_type: run
  project: upgrade
  playbook: upgrade.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  limit: "!awx"
  permissions:
  - role: execute
    team: home_users
- name: foreman.server
  job_type: run
  project: foreman
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.register
  job_type: run
  project: foreman
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.proxy
  job_type: run
  project: foreman
  playbook: proxy.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ipv6
  state: absent
  job_type: run
  project: inventory
  playbook: site/ipv6.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ntp
  job_type: run
  project: inventory
  playbook: site/ntp.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users

awx_schedules:
- name: awx.proxy
  job_template: awx.proxy
  enabled: true
  rrule: "DTSTART:20190705T002000Z RRULE:FREQ=WEEKLY;INTERVAL=2"

awx_organizations:
- name: home
  state: present
  credentials:
  - name: Demo Credential
    state: absent
  - name: awx.github
    kind: scm
    username: "{{ awx_github_user }}"
    password: "{{ awx_github_pass }}"
  - name: home.vault
    kind: vault
    vault_password: "{{ awx_vault_awx_pass }}"
  - name: home.ssh
    kind: ssh
    username: "{{ awx_machine_user }}"
    ssh_key_data: "{{ awx_machine_key }}"
  projects:
  - name: Demo Project
    state: absent
  - name: nginx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-nginx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: pdns
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-pdns.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: freeipa
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-freeipa.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: upgrade
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-upgrade.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: inventory
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: awx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-awx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: foreman
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-foreman.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  inventories:
  - name: awx
    state: absent
    source: scm
    source_project: inventory
    source_path: inventory/awx
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  - name: home
    source: scm
    source_project: inventory
    source_path: inventory/home
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  workflows:
  - name: pdns
    nodes:
    - name: pdns.recursors
      template: pdns.recursors
    - name: pdns.servers
      template: pdns.servers
      parent: pdns.recursors
    - name: pdns.records
      template: pdns.records
      parent: pdns.servers
    - name: pdns.register
      template: pdns.register
      parent: pdns.servers
    permissions:
    - role: execute
      team: home_users
  - name: freeipa
    nodes:
    - name: freeipa.servers
      template: freeipa.install.servers
    - name: freeipa.replicas
      template: freeipa.install.replicas
      parent: freeipa.servers
    - name: freeipa.proxy
      template: freeipa.install.proxy
      parent: freeipa.replicas
    - name: freeipa.clients.install.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.servers
    - name: freeipa.clients.uninstall.home
      inventory: home
      template: freeipa.uninstall.clients
      parent: freeipa.clients.install.home
      parent_type: failure
    - name: freeipa.clients.reinstall.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.clients.uninstall.home
      parent_type: always
    - name: freeipa.users.home
      inventory: home
      template: freeipa.users
      parent: freeipa.servers
    permissions:
    - role: execute
      team: home_users
  - name: awx
    nodes:
    - name: awx.configure
      template: awx.configure
      skip_tags:
      - workflows
    - name: awx.proxy
      template: awx.proxy
      parent: awx.configure
    permissions:
    - role: execute
      team: home_users
  - name: foreman
    nodes:
    - name: foreman.server
      template: foreman.server
    - name: foreman.register
      template: foreman.register
      parent: foreman.server
    - name: foreman.proxy
      template: foreman.proxy
      parent: foreman.register
    permissions:
    - role: execute
      team: home_users
  - name: provision
    nodes:
    - name: site.ntp
      template: site.ntp
    permissions:
    - role: execute
      team: home_users
  - name: site
    nodes:
    - name: provision
      template: provision
      type: workflow_job
    - name: pdns
      template: pdns
      type: workflow_job
      parent: provision
    - name: awx
      template: awx
      parent: pdns
      type: workflow_job
    - name: foreman
      template: foreman
      parent: freeipa
      type: workflow_job
    - name: freeipa
      template: freeipa
      parent: awx
      type: workflow_job
    permissions:
    - role: execute
      team: home_users
