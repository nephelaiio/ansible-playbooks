---
awx_release: 9.1.1
upgrade_reboot_host: no
nginx_proxy_url: "{{ awx_url }}"
nginx_proxy_pdns_url: "{{ pdns_url }}"
nginx_proxy_pdns_api_key: "{{ pdns_api_key }}"
nginx_proxy_upstream_group: awx_app
nginx_proxy_aws_accesskey_id: "{{ aws_access_key_id }}"
nginx_proxy_aws_accesskey_secret: "{{ aws_secret_access_key }}"
awx_admin_user: root
awx_admin_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63353839633931316432306634396338363466343238346434363830386639373738353830623163
  6464313263366231616562646564316234343334623437640a646263373663646535333862383530
  38323537613734333739396537616563323464366333373330653035363535643736386236333566
  3332383432376366390a356138396232633635303836633365623036343530643266333137346635
  3532
awx_secret_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63313762353264396234333732633339366130613637366131646533353737326163626332396438
  3665626636643633326134333766333161336331363066380a633438646361326433393963666232
  65383633393536323733333336336336383735346365393930633666356630643831393234366639
  6565306230376631660a656439626137316334616337613139333765643735633865313833616462
  37633630326562366463326130653761623631353834663833353831346538353336
awx_host_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  30303137393361373361373438303865383032353832363131306261636464626338356162393764
  3237656539363932666234336439343539326261323936640a396536323464636461343030313766
  63346463343036653833353438386466323064646264306134313632646434393864393865376266
  6537666630663236340a323437643964623232353333666533336561353063616535386333303439
  37303733333265346365623136313338613434666166363131653936323363656461303936356564
  3765663364316661363561643333643637653633316631616537
awx_pg_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  64396634313233653438643033373736323330623333353461303137383334623863336665616238
  6562626530393165393366346138613164396438663636370a636465343565656133323038613262
  32306430633932303737646465366466323766393930663062616639343935616365643065616436
  6539346230383366640a666162303961633636386436383838373237353561646463633963343666
  30633937346235316336386163363636663436313161663732303264373833646637653563643736
  6333613364633434366162383531366131326361316262393638
awx_vault_awx_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  34616165356138306439356331313630616230656634326132653537326532393533356664656535
  3966326564306465373035393735373332663032623662350a343266613362363363666662336530
  30613236636636336330623634383239313736633033326664626263326532656535316130666164
  3331663832306432610a373833626437343064656135613832336463373130396530623335343637
  6434
awx_rabbitmq_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63306538366437323038313664303665393534326532393038376166616332653937333963633339
  3832313163376462363230646563346637336330633238390a626433373935636537643762626565
  30646438353838396330346665323439376535316130383964336139316331653566393664613666
  3532623430366535380a643562353861363065636133376338636565396635316163356130663164
  33346661356138373033663364366166343462623539653734313735333262343138
awx_github_user: teddyphreak
awx_github_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  64666332396265333433383030373231633035343134613734656136636138626139383761316562
  6632616137326265633333353665643466646137656630380a616638633034306139656335393761
  65616438356565623338613239313062636662373737616364363639306662353537383338653939
  3033633634376436390a383666303664353538306462343430653833346231356666323863363739
  3235
awx_machine_user: teddyphreak
awx_machine_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  30663636636565376639306635623430373033356236353637633731613238393539633135636537
  6537643166333366383135343736616332623232343936350a363839323265653964656336666636
  63353663326666346439323562363062326566366436323266343033656634613433383932663165
  3634343861303336310a663166343437333964633536376636343763333064356439373731323262
  65346239363763666361666666663531393837303131383961343661373865616431343138643666
  62353461666430353361633866653431383734386637343038653030336166333533663831623435
  38633039363431313965623366613264373037333032313562353631363161366330666164303336
  61613737353665646161306537613263326364333561633964656532636231336264346436343636
  66623234363736353233326364393036326533396133353364366433663065613138663066383234
  34616665316639383764393864333161613966663137653361383937623765393236663337613531
  30306333313362363538643436663336383330663534336330656237343336373130623862626631
  37303739363365376531346161643138313032353935626336363732646239376630393737613061
  34356235323065353664343633613562613661653661656164373637633661353339353861393434
  32353237636337316464666439613763303463383664313739386263636331316366326663366636
  39323538626533613763316665363263663032616563343337653134393232306362653032323032
  30623161653439373265336666303966643365623061376435643237386330316664333030363265
  38623139386462353438623062396265653765333365643337373064346436333838633739376362
  65373832373130326430333031303137353336666635336536626536396264366137346233353630
  35326133623736306330613465336562663931336333323838613162613161366539643938653931
  30343738353233323235656538343730623030306632633337636666616235343333373634643936
  61643761313965396135366138316166303539623330333061353237333739343431643938616565
  32316534633532633064653062646163373636303065623130343132643539373033613834393135
  65653832376637623832356564336239613138663162643166376563313133353836333431623336
  61326131343461346165323138626463323361393061653864623831633365353533396262316133
  38316565666632643635346365373464646231323466336130306363353065333465303031343830
  36663439613137323130643264343032643536346536303462323632636164656131333537653435
  31303361333538616462383463373763336138383130366361343761353537306139393435656466
  32343235643363613738643833613362633330346534636162613634396562656137323663356539
  63303636393838643031656561623164623564333066323264656365396565326262303039373832
  32376166346637333238373035616232363130356435393930313535633665323834663766333539
  66336333356339343561326430613236393661633738633962363330616364393563323562616139
  37316639336637623837396565346330363437303364313032303131613266366538366438356161
  38383266396664323165666536363432323131383837303633353638306132613339383162393066
  66336135316539383565373266623731346361373264626632613033323062396364636139633231
  63656232636631336364626133306566656237323366353931346332376337363231643738323566
  65303063323535376237633430333238646665396636643234316561333435356336336638646462
  37653537306339333234666663343337646465356432323433643534313038323336656466636538
  66383939666264626638616435393065663865366330643338316165323535323934366261396335
  62313530633538316132616565326631316565396630656665633362633631616165313333636236
  65333231303638383632366133646532373834616235313864656364336561663863366666636365
  33383630343838656235616438643533613363323465623265643265366364383239623764386666
  30333533656437343635316266666339663561313339313139663133666132613130303163393931
  30383561333462646134366536666166643163376133623235666438363835363664653261663730
  36613262383762313730386562373237613662643139383464623834313236353633333264303431
  39663031643263356132666661386261316638646335333631633534363963333335363963303364
  39663933366665636337396238393232336462333035356665366133613331383632626563343565
  38386230323735373637303561356136353533353631353136363835303331313566313235353631
  30323639663964663238373139303533666161373562363839313866643063316538356138386630
  61663135343662353461613831313333663230336666376464663735353734356666363031636638
  32343834383761356462613838646662386266633961613165663763666164616363373033656532
  37373335363139363332356436323734383363633364353130353266323466333465333239616364
  36383939306662386363626336346666303138313635663964653634653939383330653134643832
  39663633376533363036336236306364363565666431346562633366343638366166373330366365
  31323832336561653839646336396562623366306431636234303861333332623966626234356266
  66653361323861616465366465316135663266646239366166663432633731343333356637323161
  64643963333465653733366231626363343038323932663233353765666164613432373830306235
  65623936643231666365643230383966396461333235663032356437666433343335656663373966
  37346263303132366435343630363237333266653133623662383030303330333237333665326538
  64633831373631613966316363376537613964333463373465643262633263303533376664353865
  38643435656462646136643834366636393134383364313764353132613831366234353931313535
  32323632303331633930666136306163663531343663383831323264303135646566383235653438
  65653566356662363664663833326331346239383435663133656639633266373534633432616264
  33373330336233393630623363346464356332383533323366343931616535663132653434666537
  35326632386365313132633162383939336238396237363539616332386233653536323139363061
  64633333313564366634353833363934316437666138373631366330343961303338653238643466
  32666436366630316331383534353163333835353531636230363462353130306536326532653530
  36626133363365336537356435323339633466373037373565613462336130616565623034646437
  39353239336239346337343331346565316236643665626461343634663765373062323635663630
  62363136386235363635396664303933386635646663636232313463346138303339363365306436
  38356634343964643837313035343865663935666337613566633564626633313636356330373237
  65356337396563613832353631643332316631623065626531663965653131303963333130343336
  37376461303531633861336165626231373336356233633166383461633264376333383563326361
  37653032616432353837303266376561636365653336306233303533666463373136623339316634
  31393330633632393135366532663039316161613765393061333066646562633762643062343535
  32376635353232383438336433313231643662633362613963646366623331353165626662623230
  64653862343632373034363261303937646135316535343866633730333737303765643165306338
  30363362626466663161356563653161663736636563373364313963623965303532343831353961
  31343962353066613362366166323663653732316639633132613061663030323938613862633262
  33353566383733653131326361623533343436626566663034663433653732326262393937383731
  32383832633832333138626337313336386663663130616535363032383035393330303662643130
  39613935313366376335366230376462666164303435313863356665343332326438616230633065
  64613239376233313537353562666333373630343661386535653931343634613366646134623965
  61633631363136313436316237653132346338373364306433386135343864623138353465373063
  30313765616430383466366532666532386362616536336636626135653438626566333833393937
  35363935373637633065613932656564306534646332653161643538643161313966373336623937
  31346539333538386466376637336365313266643262653266303235663761376161623431626462
  33353631336332323934366661313430313939646431366335333361356462373062323734303333
  39303634636266366133
awx_ldap_bind_user: awx
awx_ldap_bind_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  62663339343864396237313466326435656664616534353333363837333832383031346632393630
  3837616330353430663662343664393163653837643763320a313963313334306333386265646630
  32623432333065343663326165346431303138666666616263636366313833396639663162333934
  3139306236336133640a373933306433343365363262646137366535383266366164396462663362
  39366462636663666137356164663964356264323862376639333534303964346534
awx_ldap_domain_dn: "dc={{ ipaserver_domain | split_with('.') | join(',dc=') }}"
awx_ldap_connect_group:
  name: awx_users
  user:
  - teddyphreak
awx_ldap_team_map:
  home_users:
    organization: home
    users: "cn=awx_home_users,cn=groups,cn=accounts,{{ awx_ldap_domain_dn }}"
    remove: true
ipa_groups:
- name: awx_home_users
  user:
  - teddyphreak
- name: awx_users
  user:
  - teddyphreak
ipa_users:
- user_name: "{{ awx_ldap_bind_user }}"
  first_name: AWX
  last_name: Bind
  pass: "{{ awx_ldap_bind_pass }}"
  update_password: always
awx_settings:
  AUTH_LDAP_SERVER_URI: "{{ (groups['ipa_server'] + groups['ipa_replica']) | map('map_format',
    'ldap://%s:389') | join(' ') }}"
  AUTH_LDAP_GROUP_TYPE: GroupOfNamesType
  AUTH_LDAP_REQUIRE_GROUP: 'cn={{ awx_ldap_connect_group.name }},cn=groups,cn=accounts,{{
    awx_ldap_domain_dn }}'
  AUTH_LDAP_TEAM_MAP: "{{ awx_ldap_team_map }}"
  AUTH_LDAP_GROUP_TYPE_PARAMS: {}
  AUTH_LDAP_GROUP_SEARCH:
  - 'cn=groups,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(objectClass=ipausergroup)'
  AUTH_LDAP_USER_SEARCH:
  - 'cn=users,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(uid=%(user)s)'
  AUTH_LDAP_USER_ATTR_MAP:
    first_name: 'givenName'
    last_name: 'sn'
    email: 'mail'
  AUTH_LDAP_BIND_DN: "uid={{ awx_ldap_bind_user }},cn=users,cn=accounts,{{ awx_ldap_domain_dn
    }}"
  AUTH_LDAP_BIND_PASSWORD: "{{ awx_ldap_bind_pass }}"
  REMOTE_HOST_HEADERS:
  - HTTP_X_FORWARDED_FOR
  TOWER_URL_BASE: "{{ awx_url }}"
awx_teams:
- name: home_users
  organization: home
awx_users:
- first_name: CI
  last_name: Integration
  username: "{{ awx_ci_user }}"
  password: "{{ awx_ci_pass }}"
  email: "{{ awx_ci_email }}"
  superuser: yes
awx_templates:
- name: Demo Job Template
  state: absent
- name: awx.configure
  job_type: run
  project: awx
  inventory: home
  playbook: configure.yml
  skip_tags:
  - awx_skip
  ask_skip_tags: yes
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: awx.proxy
  job_type: run
  project: inventory
  inventory: home
  playbook: awx/proxy.yml
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.recursors
  job_type: run
  project: pdns
  playbook: recursor.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.servers
  job_type: run
  project: pdns
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.records
  job_type: run
  project: pdns
  playbook: records.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.register
  job_type: run
  project: pdns
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: traefik.restart
  job_type: run
  project: inventory
  playbook: traefik/restart.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: upgrade
  job_type: run
  project: upgrade
  playbook: upgrade.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  limit: "!awx"
  permissions:
  - role: execute
    team: home_users
- name: foreman.server
  job_type: run
  project: foreman
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.register
  job_type: run
  project: foreman
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.proxy
  job_type: run
  project: foreman
  playbook: proxy.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ipv6
  state: absent
  job_type: run
  project: inventory
  playbook: site/ipv6.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ntp
  job_type: run
  project: inventory
  playbook: site/ntp.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
awx_schedules:
- name: awx.proxy
  job_template: awx.proxy
  enabled: true
  rrule: "DTSTART:20190705T002000Z RRULE:FREQ=WEEKLY;INTERVAL=2"
awx_organizations:
- name: home
  state: present
  credentials:
  - name: Demo Credential
    state: absent
  - name: awx.github
    kind: scm
    username: "{{ awx_github_user }}"
    password: "{{ awx_github_pass }}"
  - name: home.vault
    kind: vault
    vault_password: "{{ awx_vault_awx_pass }}"
  - name: home.ssh
    kind: ssh
    username: "{{ awx_machine_user }}"
    ssh_key_data: "{{ awx_machine_key }}"
  projects:
  - name: Demo Project
    state: absent
  - name: nginx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-nginx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: pdns
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-pdns.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: freeipa
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-freeipa.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: upgrade
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-upgrade.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: inventory
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: awx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-awx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: foreman
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-foreman.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  inventories:
  - name: awx
    state: absent
    source: scm
    source_project: inventory
    source_path: inventory/awx
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  - name: home
    source: scm
    source_project: inventory
    source_path: inventory/home
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  workflows:
  - name: pdns
    nodes:
    - name: pdns.recursors
      template: pdns.recursors
    - name: pdns.servers
      template: pdns.servers
      parent: pdns.recursors
    - name: pdns.records
      template: pdns.records
      parent: pdns.servers
    - name: pdns.register
      template: pdns.register
      parent: pdns.servers
    permissions:
    - role: execute
      team: home_users
  - name: freeipa
    nodes:
    - name: freeipa.servers
      template: freeipa.install.servers
    - name: freeipa.replicas
      template: freeipa.install.replicas
      parent: freeipa.servers
    - name: freeipa.proxy
      template: freeipa.install.proxy
      parent: freeipa.replicas
    - name: freeipa.clients.install.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.servers
    - name: freeipa.clients.uninstall.home
      inventory: home
      template: freeipa.uninstall.clients
      parent: freeipa.clients.install.home
      parent_type: failure
    - name: freeipa.clients.reinstall.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.clients.uninstall.home
      parent_type: always
    - name: freeipa.users.home
      inventory: home
      template: freeipa.users
      parent: freeipa.servers
    permissions:
    - role: execute
      team: home_users
  - name: awx
    nodes:
    - name: awx.configure
      template: awx.configure
      skip_tags:
      - workflows
    - name: awx.proxy
      template: awx.proxy
      parent: awx.configure
    permissions:
    - role: execute
      team: home_users
  - name: foreman
    nodes:
    - name: foreman.server
      template: foreman.server
    - name: foreman.register
      template: foreman.register
      parent: foreman.server
    - name: foreman.proxy
      template: foreman.proxy
      parent: foreman.register
    permissions:
    - role: execute
      team: home_users
  - name: provision
    nodes:
    - name: site.ntp
      template: site.ntp
    permissions:
    - role: execute
      team: home_users
  - name: site
    nodes:
    - name: provision
      template: provision
      type: workflow_job
    - name: pdns
      template: pdns
      type: workflow_job
      parent: provision
    - name: awx
      template: awx
      parent: pdns
      type: workflow_job
    - name: foreman
      template: foreman
      parent: freeipa
      type: workflow_job
    - name: freeipa
      template: freeipa
      parent: awx
      type: workflow_job
    permissions:
    - role: execute
      team: home_users
