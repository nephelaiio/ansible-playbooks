---
awx_release: 9.1.1

awx_admin_user: root
awx_admin_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_secret_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_pg_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_vault_home_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_vault_common_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_rabbitmq_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_github_user: teddyphreak
awx_github_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

awx_ldap_bind_user: awx
awx_ldap_bind_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63356632336531326338363362363833616439386264313565323761663466656235613636383734
  3562373737356434386464373839303234366633653635390a643734323564303163663738326161
  62356632366333633564633363643563396662396264353939376535313530333539643333336164
  3737336233613136370a373164316231353636383362376162313537663137393866366232333334
  6137

ipa_users:
- user_name: "{{ awx_ldap_bind_user }}"
  first_name: AWX
  last_name: Bind
  pass: "{{ awx_ldap_bind_pass }}"
  update_password: always
awx_settings:
  AUTH_LDAP_SERVER_URI: "{{ (groups['ipa_server'] + groups['ipa_replica']) | map('map_format',
    'ldap://%s:389') | join(' ') }}"
  AUTH_LDAP_GROUP_TYPE: GroupOfNamesType
  AUTH_LDAP_REQUIRE_GROUP: 'cn={{ awx_ldap_connect_group.name }},cn=groups,cn=accounts,{{
    awx_ldap_domain_dn }}'
  AUTH_LDAP_TEAM_MAP: "{{ awx_ldap_team_map }}"
  AUTH_LDAP_GROUP_TYPE_PARAMS: {}
  AUTH_LDAP_GROUP_SEARCH:
  - 'cn=groups,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(objectClass=ipausergroup)'
  AUTH_LDAP_USER_SEARCH:
  - 'cn=users,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(uid=%(user)s)'
  AUTH_LDAP_USER_ATTR_MAP:
    first_name: 'givenName'
    last_name: 'sn'
    email: 'mail'
  AUTH_LDAP_BIND_DN: "uid={{ awx_ldap_bind_user }},cn=users,cn=accounts,{{ awx_ldap_domain_dn
    }}"
  AUTH_LDAP_BIND_PASSWORD: "{{ awx_ldap_bind_pass }}"
  REMOTE_HOST_HEADERS:
  - HTTP_X_FORWARDED_FOR
  TOWER_URL_BASE: "{{ awx_url }}"

awx_teams:
- name: home_users
  organization: home

awx_users:
- first_name: CI
  last_name: Integration
  username: "{{ awx_ci_user }}"
  password: "{{ awx_ci_pass }}"
  email: "{{ awx_ci_email }}"
  superuser: yes

awx_templates:
- name: Demo Job Template
  state: absent
- name: awx.configure
  job_type: run
  project: awx
  inventory: home
  playbook: configure.yml
  skip_tags:
  - awx_skip
  ask_skip_tags: yes
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: awx.proxy
  job_type: run
  project: inventory
  inventory: home
  playbook: awx/proxy.yml
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.recursors
  job_type: run
  project: pdns
  playbook: recursor.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.servers
  job_type: run
  project: pdns
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.records
  job_type: run
  project: pdns
  playbook: records.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.register
  job_type: run
  project: pdns
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: traefik.restart
  job_type: run
  project: inventory
  playbook: traefik/restart.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: upgrade
  job_type: run
  project: upgrade
  playbook: upgrade.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  limit: "!awx"
  permissions:
  - role: execute
    team: home_users
- name: foreman.server
  job_type: run
  project: foreman
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.register
  job_type: run
  project: foreman
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.proxy
  job_type: run
  project: foreman
  playbook: proxy.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ipv6
  state: absent
  job_type: run
  project: inventory
  playbook: site/ipv6.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ntp
  job_type: run
  project: inventory
  playbook: site/ntp.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users

awx_schedules:
- name: awx.proxy
  job_template: awx.proxy
  enabled: true
  rrule: "DTSTART:20190705T002000Z RRULE:FREQ=WEEKLY;INTERVAL=2"

awx_organizations:
- name: home
  state: present
  credentials:
  - name: Demo Credential
    state: absent
  - name: awx.github
    kind: scm
    username: "{{ awx_github_user }}"
    password: "{{ awx_github_pass }}"
  - name: home.vault
    kind: vault
    vault_password: "{{ awx_vault_awx_pass }}"
  - name: home.ssh
    kind: ssh
    username: "{{ awx_machine_user }}"
    ssh_key_data: "{{ awx_machine_key }}"
  projects:
  - name: Demo Project
    state: absent
  - name: nginx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-nginx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: pdns
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-pdns.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: freeipa
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-freeipa.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: upgrade
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-upgrade.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: inventory
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: awx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-awx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: foreman
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-foreman.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  inventories:
  - name: awx
    state: absent
    source: scm
    source_project: inventory
    source_path: inventory/awx
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  - name: home
    source: scm
    source_project: inventory
    source_path: inventory/home
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  workflows:
  - name: pdns
    nodes:
    - name: pdns.recursors
      template: pdns.recursors
    - name: pdns.servers
      template: pdns.servers
      parent: pdns.recursors
    - name: pdns.records
      template: pdns.records
      parent: pdns.servers
    - name: pdns.register
      template: pdns.register
      parent: pdns.servers
    permissions:
    - role: execute
      team: home_users
  - name: freeipa
    nodes:
    - name: freeipa.servers
      template: freeipa.install.servers
    - name: freeipa.replicas
      template: freeipa.install.replicas
      parent: freeipa.servers
    - name: freeipa.proxy
      template: freeipa.install.proxy
      parent: freeipa.replicas
    - name: freeipa.clients.install.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.servers
    - name: freeipa.clients.uninstall.home
      inventory: home
      template: freeipa.uninstall.clients
      parent: freeipa.clients.install.home
      parent_type: failure
    - name: freeipa.clients.reinstall.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.clients.uninstall.home
      parent_type: always
    - name: freeipa.users.home
      inventory: home
      template: freeipa.users
      parent: freeipa.servers
    permissions:
    - role: execute
      team: home_users
  - name: awx
    nodes:
    - name: awx.configure
      template: awx.configure
      skip_tags:
      - workflows
    - name: awx.proxy
      template: awx.proxy
      parent: awx.configure
    permissions:
    - role: execute
      team: home_users
  - name: foreman
    nodes:
    - name: foreman.server
      template: foreman.server
    - name: foreman.register
      template: foreman.register
      parent: foreman.server
    - name: foreman.proxy
      template: foreman.proxy
      parent: foreman.register
    permissions:
    - role: execute
      team: home_users
  - name: provision
    nodes:
    - name: site.ntp
      template: site.ntp
    permissions:
    - role: execute
      team: home_users
  - name: site
    nodes:
    - name: provision
      template: provision
      type: workflow_job
    - name: pdns
      template: pdns
      type: workflow_job
      parent: provision
    - name: awx
      template: awx
      parent: pdns
      type: workflow_job
    - name: foreman
      template: foreman
      parent: freeipa
      type: workflow_job
    - name: freeipa
      template: freeipa
      parent: awx
      type: workflow_job
    permissions:
    - role: execute
      team: home_users
