---
awx_release: 9.1.1
upgrade_reboot_host: no
nginx_proxy_url: "{{ awx_url }}"
nginx_proxy_pdns_url: "{{ pdns_url }}"
nginx_proxy_pdns_api_key: "{{ pdns_api_key }}"
nginx_proxy_upstream_group: awx_app
nginx_proxy_aws_accesskey_id: "{{ aws_access_key_id }}"
nginx_proxy_aws_accesskey_secret: "{{ aws_secret_access_key }}"

awx_admin_user: root
awx_admin_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63343265316339643736613466386635323263376134386566633231343161336238313831393838
  3033616262386663613031303633353365393030333735610a626539343165663438383733666433
  32313330656461333066303238636434383666303637653864633538346434646634356663616332
  6562626161626539320a666530383535613664353136326431666261646537636631366263363738
  64313966643135363462343664663664363832343237336436636536653930623263616437363236
  3738333738366536653638363130656136376262346633356161

awx_secret_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  37333465353537663639356537626233336338383761393432653038666663346462373837323136
  6532313063653561623931343330373038303164396162640a383365356362323434613066633933
  35636263386230653732393530633864306435633535663266613531393865383066616437363334
  6336326461653535350a653839616633393833666535383864626632323536356339393366356433
  39663963313365636362343765636366646632653166643230666166393762393934

awx_pg_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  63643033393763353163313265316331393338623839383464333339376235343762666230623933
  3061363431373532373339303135316430626431363436310a306237613632313632633338623765
  39336331623465333939383235646236636638363035663736343139616639646164316234376136
  3763316237663634300a663564616361653365333265656565323661346531343465666664393935
  36336162323030383432383865336533666165363834383465396261313235323637

awx_vault_awx_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  61643761373562336466353738616535393136326539366631636362363561333631363862313931
  3239393031396263626161616563323335343432643833620a613738646236633265353465363536
  35306431336130653033613564313264313337633736333866363233393630656565393438633761
  3135376532323636640a346135363834613037613135663135653138663531376435373632333536
  63356261313361373964393065323634643663363463343731316163316461306133396631356333
  6135346339623061376639363762616163356639623532353362

awx_rabbitmq_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  38306539636638336163656566623563333264323934636533653063613934636461346632346237
  3666353138616438653531323231393839633765663333350a363066346564336334646434376365
  39383831393665636637626265336330373561326638656636646531313337343932646433393262
  3864303433343033330a633834613961303738376336616232303930313866643866363034363037
  34663436646338636133323065303638373763333564333666613963636131346533343066616138
  6232616635396362646132373961626134356333626132333965

awx_github_user: teddyphreak
awx_github_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  64666332396265333433383030373231633035343134613734656136636138626139383761316562
  6632616137326265633333353665643466646137656630380a616638633034306139656335393761
  65616438356565623338613239313062636662373737616364363639306662353537383338653939
  3033633634376436390a383666303664353538306462343430653833346231356666323863363739
  3235

awx_machine_user: "{{ users.root.username }}"
awx_machine_key: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  38346139343065626337633135313634363464343732646566306562643031626537373734353633
  3463303231353463313761383234363866616563343232390a303266336330396637306439343464
  33306337663932303839396436303735343338383036386238643137653135366233326364643338
  3737643235636462650a363434376463313233373863326565653863343066326635313638363665
  36323937346665356339343562303738636536306332623733633733633132383166643835663764
  34633463613935613266336563346437633962613464366537316165623665616535376264323730
  33393730333837393865316130616535363961633266396466353561306666613533663665613461
  37313532333866393264306636353630386437396635353034306635656361343465663561316663
  64393462616166376166373862373938633430643535646437326434613736616430613066323734
  63313762653834643838373633346565633237613264363234623639396162323864383133366162
  62623666343033356163316335323732386639383661316537316239373336313936613562623032
  31393764303161633763356138643236396263333462613763316166616232326261613263653964
  33613066633163383930353266663731356533666335663865366461623230663135626538363366
  35366662626135356266363934363033376464306430656462336134633463323562386530666138
  36383338306465343663333538316437303434653766373339313839643636633534626236306236
  66646563313238383161383965356239643332366332643033363938663930656163343232643732
  63346633633564643234613938313231643566386666333634313166316432396632633434653235
  31643362353236656633643962373635363362383234356339306637643933313236646435353032
  64313466616131346138396135333039656132636464346230656537656565666131396139616163
  65356166366534363638636365303233613566363133373263343838616132393733656334303361
  38383465376435653563396161346165663738663835343964666339626163306335386335383461
  61633761356437363435343761653864346337613636626438613836346562376563366630633962
  33376435356539363464326566363538363934383631303266636335613962323333383134323065
  64386333616430353037366130663332613262303564316134623532343064306331353564323964
  35326163323831646138353465393265326365656562333933383639366633616265393638613734
  66373961343933616231346636643761373230373533393235376163333265336630303730376131
  37323231656361653431636363643063663133656161613939353637313633336536356530643433
  33303538366531356137316366383631343361313531346264323665326234623133353338383039
  30303030353839326661303264633761343163326666666561333533656132396233373837653635
  32326436646435323934646366343963633330306534623334303162386138643234613334363066
  31646338353463623537393230666438376164653461623633633637373839323664313865353365
  62623331656136623762376230356237343163616263306133666132343364643239363062663730
  64643364313164343037353064313330643036613735633532623532663236316637373737333133
  30633861326232333464643933363564373036333830386439623961333665326565396364303535
  31373236396533633961626538343866376139386336353339366335343537373433386230363363
  39396263613064626463376231613038303638656336646264663063323535663737363835306637
  32346238633630326234626139643039623537613663633031316163396436313636303033333930
  66366563616535386536346536633638633466353733306461363632346263333733306239353135
  65386237376264396166313131366461326664633234336233663065633638663534363635386431
  39363461653335336432653432646464393739343530623961613435663832343339383930613465
  32383231316333613963346365343138623635396162326332333234366635666339343434316337
  62623037613233323033663065323635383865636262353365353562373830326537333562656262
  65616136326534353035343731636436336136373861326463313139363066643338306531383664
  62636630373533666631663639633036633935303638336165343630356365393832353264373263
  39323439333862663463613065623966386666343066326637663531353863363365333035303232
  34646137376462643731653034663066346564663761643861393462376435373734373230353439
  33643064373833393661303061666338366464316366333135656434333664383434333734306335
  61643136643664613432613430346564316533396134663732353966383235313837313530383133
  31373232636534346438346339636464383932323139643031353834623637643266353033303632
  63333332353433633430336137626533306639353163393261313563646562623962333363376330
  65343965383435643732366232663130663631326164326166376638666665313135643261346339
  65363562616266643936353266356139306432643836666231373762306333373663323531633637
  39306130633662386365346132393839393534376233393761346537653966313764653366393931
  62646135353830303830636439613931336666313739346535393665303866353962303465636230
  64626361656431656463343831626663336139643235313262633037663564626466353734396336
  65636466313263643030616462613939613531626135383864653838613636643336356331636436
  37323130363663663932663231356137356139353031336430376336373431633534646435383431
  32323537313234613530346662366430333038363732323365303534366231313735623230356233
  38373061383631316235323938383438366664666430383833393833356261326435636332643833
  35326166383933313532376436643037643763653762383231353464376463643531643661613733
  37356634663736363336633264346663346335336364306639653938383331663265653138356230
  30666662316339333065393834383334353363613962636337313034373031343632386161666332
  34643832623633393564623138623261653462646134653931626530316164396637393766366334
  63663232316434646537333562353438376564373537616562653766356634623235353638303061
  62336330346139323933653432303538353330323039383739636339373064343938633833616537
  61373062313933636232343365396538653963393961623139666637663635323030366332393963
  33336262303633303866343062643562343934616235363763333036643239646137343661313531
  39303132616161636434353162303237653461663834366331626430653532393939626664663961
  35373366346537653634303566313034306637646631316138363565633036626536656433623236
  65646563376130616333376239333332636334383431396661666339316566343637356162393061
  65653861333461303166633530323365363330636531326337386337396462383833663035653064
  35333439373239353733323136666135333836656562663163323165333565653132303061666631
  65373834396162386634623861613134343962383365306234613537373632323434366335383865
  64323735633764666537363933373836333561353836323262373861346335623361346632373131
  64666439616664373136366562323031613738653631323130626162383934353763343836316130
  63383936396336333663663936343936656664633134333862653634616362623964653164386432
  62666665663863616636386237396532636465396361366634313361653435656432656663356230
  38613132353632346635656561383630393938363130623235653435636534366464393863366561
  30396137656565616465656539333538383736303338346233666538656461633665343639383831
  37393663363638636165613165343339366630333232653436653738313832643731363266633931
  61353134626333343063323532383038373162626161366130333964383930346238356134373564
  32323238626531656638353634626138346239383764646638383566343931373539616231333839
  65373666663335363436363662633963643865313136646635343637373631373533343730393363
  39336634653835323662636465343839613734623965626632623834646136633161346338616365
  31396262366364633034613363663237376565636666343031656333646431376431653433336636
  65346430323635343132343238633236326165613737333336353138633732323263653664363163
  31316438346633623330356564663137363332633137306233653361643738316665666561303364
  30386237316362313564|

awx_ldap_bind_user: awx
awx_ldap_bind_pass: !vault |
  $ANSIBLE_VAULT;1.2;AES256;home
  61653362373535643861333361623935353938336433623832343162376563623730396333303736
  6637656432363139373136626361363638343561363234630a613462643261643763323538633038
  38343631313865346266653030643866343033646434313031363233653232663633396166653732
  3661393732623138310a653738663436626438656461666337353762333663393765363134643661
  39343934646535343563393738636432383339323837313434636635663635316233

ipa_users:
- user_name: "{{ awx_ldap_bind_user }}"
  first_name: AWX
  last_name: Bind
  pass: "{{ awx_ldap_bind_pass }}"
  update_password: always
awx_settings:
  AUTH_LDAP_SERVER_URI: "{{ (groups['ipa_server'] + groups['ipa_replica']) | map('map_format',
    'ldap://%s:389') | join(' ') }}"
  AUTH_LDAP_GROUP_TYPE: GroupOfNamesType
  AUTH_LDAP_REQUIRE_GROUP: 'cn={{ awx_ldap_connect_group.name }},cn=groups,cn=accounts,{{
    awx_ldap_domain_dn }}'
  AUTH_LDAP_TEAM_MAP: "{{ awx_ldap_team_map }}"
  AUTH_LDAP_GROUP_TYPE_PARAMS: {}
  AUTH_LDAP_GROUP_SEARCH:
  - 'cn=groups,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(objectClass=ipausergroup)'
  AUTH_LDAP_USER_SEARCH:
  - 'cn=users,cn=accounts,{{ awx_ldap_domain_dn }}'
  - 'SCOPE_SUBTREE'
  - '(uid=%(user)s)'
  AUTH_LDAP_USER_ATTR_MAP:
    first_name: 'givenName'
    last_name: 'sn'
    email: 'mail'
  AUTH_LDAP_BIND_DN: "uid={{ awx_ldap_bind_user }},cn=users,cn=accounts,{{ awx_ldap_domain_dn
    }}"
  AUTH_LDAP_BIND_PASSWORD: "{{ awx_ldap_bind_pass }}"
  REMOTE_HOST_HEADERS:
  - HTTP_X_FORWARDED_FOR
  TOWER_URL_BASE: "{{ awx_url }}"

awx_teams:
- name: home_users
  organization: home

awx_users:
- first_name: CI
  last_name: Integration
  username: "{{ awx_ci_user }}"
  password: "{{ awx_ci_pass }}"
  email: "{{ awx_ci_email }}"
  superuser: yes

awx_templates:
- name: Demo Job Template
  state: absent
- name: awx.configure
  job_type: run
  project: awx
  inventory: home
  playbook: configure.yml
  skip_tags:
  - awx_skip
  ask_skip_tags: yes
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: awx.proxy
  job_type: run
  project: inventory
  inventory: home
  playbook: awx/proxy.yml
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.recursors
  job_type: run
  project: pdns
  playbook: recursor.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.servers
  job_type: run
  project: pdns
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.records
  job_type: run
  project: pdns
  playbook: records.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: pdns.register
  job_type: run
  project: pdns
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: traefik.restart
  job_type: run
  project: inventory
  playbook: traefik/restart.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: upgrade
  job_type: run
  project: upgrade
  playbook: upgrade.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  limit: "!awx"
  permissions:
  - role: execute
    team: home_users
- name: foreman.server
  job_type: run
  project: foreman
  playbook: server.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.register
  job_type: run
  project: foreman
  playbook: register.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: foreman.proxy
  job_type: run
  project: foreman
  playbook: proxy.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ipv6
  state: absent
  job_type: run
  project: inventory
  playbook: site/ipv6.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users
- name: site.ntp
  job_type: run
  project: inventory
  playbook: site/ntp.yml
  inventory: home
  credentials:
  - name: home.ssh
    kind: ssh
  - name: home.vault
    kind: vault
  permissions:
  - role: execute
    team: home_users

awx_schedules:
- name: awx.proxy
  job_template: awx.proxy
  enabled: true
  rrule: "DTSTART:20190705T002000Z RRULE:FREQ=WEEKLY;INTERVAL=2"

awx_organizations:
- name: home
  state: present
  credentials:
  - name: Demo Credential
    state: absent
  - name: awx.github
    kind: scm
    username: "{{ awx_github_user }}"
    password: "{{ awx_github_pass }}"
  - name: home.vault
    kind: vault
    vault_password: "{{ awx_vault_awx_pass }}"
  - name: home.ssh
    kind: ssh
    username: "{{ awx_machine_user }}"
    ssh_key_data: "{{ awx_machine_key }}"
  projects:
  - name: Demo Project
    state: absent
  - name: nginx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-nginx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: pdns
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-pdns.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: freeipa
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-freeipa.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: upgrade
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-upgrade.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: inventory
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: awx
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-awx.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  - name: foreman
    scm_type: git
    scm_url: https://github.com/nephelaiio/ansible-playbooks-foreman.git
    scm_branch: master
    scm_delete_on_update: false
    scm_credential: awx.github
    scm_update_on_launch: false
    scm_update_cache_timeout: 60
    scm_clean: false
  inventories:
  - name: awx
    state: absent
    source: scm
    source_project: inventory
    source_path: inventory/awx
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  - name: home
    source: scm
    source_project: inventory
    source_path: inventory/home
    overwrite: true
    overwrite_vars: true
    update_on_launch: false
    update_on_project_update: true
  workflows:
  - name: pdns
    nodes:
    - name: pdns.recursors
      template: pdns.recursors
    - name: pdns.servers
      template: pdns.servers
      parent: pdns.recursors
    - name: pdns.records
      template: pdns.records
      parent: pdns.servers
    - name: pdns.register
      template: pdns.register
      parent: pdns.servers
    permissions:
    - role: execute
      team: home_users
  - name: freeipa
    nodes:
    - name: freeipa.servers
      template: freeipa.install.servers
    - name: freeipa.replicas
      template: freeipa.install.replicas
      parent: freeipa.servers
    - name: freeipa.proxy
      template: freeipa.install.proxy
      parent: freeipa.replicas
    - name: freeipa.clients.install.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.servers
    - name: freeipa.clients.uninstall.home
      inventory: home
      template: freeipa.uninstall.clients
      parent: freeipa.clients.install.home
      parent_type: failure
    - name: freeipa.clients.reinstall.home
      inventory: home
      template: freeipa.install.clients
      parent: freeipa.clients.uninstall.home
      parent_type: always
    - name: freeipa.users.home
      inventory: home
      template: freeipa.users
      parent: freeipa.servers
    permissions:
    - role: execute
      team: home_users
  - name: awx
    nodes:
    - name: awx.configure
      template: awx.configure
      skip_tags:
      - workflows
    - name: awx.proxy
      template: awx.proxy
      parent: awx.configure
    permissions:
    - role: execute
      team: home_users
  - name: foreman
    nodes:
    - name: foreman.server
      template: foreman.server
    - name: foreman.register
      template: foreman.register
      parent: foreman.server
    - name: foreman.proxy
      template: foreman.proxy
      parent: foreman.register
    permissions:
    - role: execute
      team: home_users
  - name: provision
    nodes:
    - name: site.ntp
      template: site.ntp
    permissions:
    - role: execute
      team: home_users
  - name: site
    nodes:
    - name: provision
      template: provision
      type: workflow_job
    - name: pdns
      template: pdns
      type: workflow_job
      parent: provision
    - name: awx
      template: awx
      parent: pdns
      type: workflow_job
    - name: foreman
      template: foreman
      parent: freeipa
      type: workflow_job
    - name: freeipa
      template: freeipa
      parent: awx
      type: workflow_job
    permissions:
    - role: execute
      team: home_users
