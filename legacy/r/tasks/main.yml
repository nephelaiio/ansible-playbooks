---
- include_vars: "{{ item }}"
  with_first_found:
    - "vars/{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"
    - "vars/{{ ansible_distrubition }}.yml"
    - "vars/{{ ansible_os_family }}.yml"
    - "vars/default.yml"
  when: r_packages is not defined
  tags:
    - r

- name: install CRAN debian repository key
  apt_key: >
    keyserver=keys.gnupg.net
    id=381BA480
  become: yes
  when:
    ansible_distribution == "Debian"
  tags:
    - cran
    - r

- name: install CRAN ubuntu repository key
  apt_key: >
    keyserver=keyserver.ubuntu.com
    id=E084DAB9
  become: yes
  when:
    ansible_distribution == "Ubuntu"
  tags:
    - cran
    - r

- name: install CRAN yum repository
  apt_repository: >
    repo="deb http://cran.rstudio.com/bin/linux/{{ ansible_distribution|lower }} {{ ansible_distribution_release }}{{ '-cran3' if ansible_distribution == "Debian" else '' }}/"
  become: yes
  when:
    ansible_os_family == "Debian"
  tags:
    - cran
    - r

- name: install R packages
  package: >
    name={{ item }} 
    state=latest
  with_items:
    - "{{ r_packages }}"
  become: yes
  tags:
    - r
