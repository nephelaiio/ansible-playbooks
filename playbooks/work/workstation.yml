---
- name: Configure satellite host

  hosts: iml-700-102

  roles:

    - nephelaiio.tree
    - nephelaiio.vim
    - nephelaiio.devtools
    - nephelaiio.pyenv
    - nephelaiio.tmux
    - nephelaiio.i3
    - nephelaiio.rbenv

  tasks:

    - name: Disable systemd-resolved
      service:
        name: systemd-resolved
        state: stopped
        enabled: no
      become: yes

    - name: Configure name resolution
      include_role:
        name: ahuffman.resolv
      vars:
        resolv_nameservers:
          - 10.50.2.3
          - 10.50.2.2
        resolv_search:
          - true.local
          - local
        resolv_options:
          - timeout:1
      become: yes

    - name: Install work specific packages
      apt:
        name:
          - emacs25-nox
          - docker.io
        state: latest
        autoclean: yes
        autoremove: yes
      become: yes

    - name: Initialize spacemacs
      git:
        repo: https://github.com/syl20bnr/spacemacs.git
        dest: ~/.emacs.d

    - name: Initialize font directory
      file:
        state: directory
        path: ~/.fonts

    - name: Install source code pro font
      unarchive:
        src: https://github.com/adobe-fonts/source-code-pro/archive/2.030R-ro/1.050R-it.tar.gz
        dest: ~/.fonts
        remote_src: yes

    - include: ../upgrade.yml


- name: Configure workstation

  hosts: iml-700-101

  environment:

    http_proxy: http://10.50.2.254:8080
    https_proxy: http://10.50.2.254:8080

  roles:

    - nephelaiio.tree
    - nephelaiio.vim
    - nephelaiio.devtools
    - nephelaiio.pyenv
    - nephelaiio.tmux
    - nephelaiio.i3
    - nephelaiio.docker
    - nephelaiio.rbenv

  tasks:

    - name: Configure name resolution
      include_role:
        name: ahuffman.resolv
      vars:
        resolv_nameservers:
          - 10.50.2.3
          - 10.50.2.2
        resolv_search:
          - true.local
          - local
        resolv_options:
          - timeout:1
      become: yes

    - name: Disable systemd-resolved
      service:
        name: systemd-resolved
        state: stopped
        enabled: no
      become: yes

    - name: Install work specific packages
      apt:
        name:
          - openvpn
          - ntfs-3g
          - bridge-utils
          - remmina
          - pkg-config
          - libvirt-bin
          - libvirt-dev
          - keepass2
          - xdotool
          - wireless-tools
          - wpasupplicant
          - ebtables
          - apt-mirror
        state: latest
        autoclean: yes
        autoremove: yes
      become: yes

    - include: ../upgrade.yml
