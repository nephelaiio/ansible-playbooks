# vim: ts=2 sw=2 et :

# TODO:
#  - Install bind and add dynamic dns updates
#  - Create home mx records
#  - Split tasks 
#  - Install and configure postfix
#  - Remove dhcp from wireless router
---
- include: setup.yml


- hosts: unifi

  vars:
    unifi_controller_packages_state: latest

  roles:
    - { role: nephelaiio.unifi-controller }
    - { role: debops.dhcpd }

  become: yes

  tasks:
    - name: install oracle java 8
      package:
        name: oracle-java8-jdk
        state: latest
      notify:
        - restart unifi

    - name: update java alternatives
      alternatives:
        name: java
        path: /usr/lib/jvm/jdk-8-oracle-arm32-vfp-hflt/jre/bin/java
        priority: 2000
      notify:
        - restart unifi

    - name: upgrade unify host
      apt:
        upgrade: dist
      when:
        - upgrade|default(false)|bool == true
        - ansible_os_family == 'Debian'
      become: yes
      notify:
        - restart unifi

    - name: update mongodb configuration
      lineinfile:
        path: /etc/mongodb.conf
        regexp: '^ENABLE_MONGODB='
        line: 'ENABLE_MONGODB=no'
      notify:
        - restart mongodb

  handlers:

    - name: restart unifi 
      service:
        name: unifi
        state: restarted

    - name: restart mongodb
      service:
        name: mongodb
        state: restarted
      
