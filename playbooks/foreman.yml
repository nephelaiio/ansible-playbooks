---

- include: ping.yml 

- include: upgrade.yml

- hosts: "{{ target_hosts | default('foreman') }}"

  tasks:

    - include: "foreman/{{ ansible_os_family | lower }}.yml"

    - name: install foreman installer
      become: yes
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - epel-release
        - foreman-installer

    - name: run foreman installer
      when: foreman_package_query.rc != 0
      command: |
        foreman-installer --enable-foreman-plugin-ansible --no-enable-foreman-proxy
