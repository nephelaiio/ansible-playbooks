---
galaxy_info:
  author: Ted Cook

  license: MIT

  min_ansible_version: 2.8

  platforms:
    - name: Ubuntu
      versions:
        - 18.04

  galaxy_tags:
    - traefik
    - consul

dependencies:
  - role: brianshumate.consul
    vars:
      consul_domain: "{{ consul_dns_zone }}"
      consul_client_address: 0.0.0.0
      consul_node_role: server
      consul_bootstrap_expect: yes
      consul_install_upgrade: yes
      consul_autopilot_enable: yes
      consul_autopilot_cleanup_dead_servers: yes
      consul_enable_local_script_checks: yes
      consul_user: consul
      consul_data_path: /var/consul
      consul_acl_master_token: "{{ consul_master_token }}"
      consul_acl_agent_token: "{{ consul_master_token }}"
      consul_acl_token: "{{ consul_token }}"
  - role: bertvv.hosts
    vars:
      hosts_entries:
        - name: "{{ consul_dns_zone }}"
          ip: "{{ ansible_default_ipv4.address }}"
  - role: bertvv.dnsmasq
    vars:
      dnsmasq_upstream_servers:
        - "/.{{ consul_dns_zone }}/127.0.0.1#{{ consul_ports_dns }}"
