---
- include_vars: "{{ item }}"
  with_first_found:
    - "vars/{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"
    - "vars/{{ ansible_distrubition }}.yml"
    - "vars/{{ ansible_os_family }}.yml"
    - "vars/default.yml"
  when: virtualbox_packages is not defined
  tags:
    - virtualbox

- name: install virtualbox yum repo
  copy: >
    src=virtualbox.repo
    dest=/etc/yum.repos.d
  become: yes
  when: 
    ansible_os_family == "RedHat"
  tags:
    - virtualbox

- name: install virtualbox repo key
  rpm_key: >
    state=present
    key=https://www.virtualbox.org/download/oracle_vbox.asc
  become: yes
  when: 
    ansible_os_family == "RedHat"
  tags:
    - virtualbox

- name: install virtualbox package
  package: >
    name={{ item }} 
    state=latest
  with_items:
    - "{{ virtualbox_packages }}"
  become: yes
  tags:
    - virtualbox

- name: load virtualbox modules
  copy: >
    src=modules.conf
    dest=/etc/modules-load.d/virtualbox.conf
  become: yes
  when:
    ansible_os_family == "Antergos" or ansible_os_family == "Archlinux"
  tags:
    - virtualbox
