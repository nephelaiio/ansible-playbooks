---
- include_vars: "{{ item }}"
  with_first_found:
    - "vars/{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"
    - "vars/{{ ansible_distrubition }}.yml"
    - "vars/{{ ansible_os_family }}.yml"
    - "vars/default.yml"
  when: vagrant_packages is not defined
  tags:
    - vagrant

- name: download vagrant yum package
  get_url: >
    dest=/tmp/vagrant.rpm
    url=https://releases.hashicorp.com/vagrant/1.8.1/vagrant_1.8.1_x86_64.rpm
  when:
    ansible_os_family == "RedHat" 
  become: yes
  tags:
    - vagrant

- name: install vagrant yum package
  yum: >
    name=/tmp/vagrant.rpm
  when:
    ansible_os_family == "RedHat" 
  become: yes
  tags:
    - vagrant
    
- name: install vagrant package
  package: >
    name={{ item }} 
    state=latest
  with_items:
    - "{{ vagrant_packages }}"
  when:
    ansible_os_family != "RedHat"
  become: yes
  tags:
    - vagrant

- name: verify vagrant-berkshelf plugin
  shell: "vagrant plugin list | grep vagrant-berkshelf"
  register: vagrant_berkshelf
  ignore_errors: yes
  changed_when: "vagrant_berkshelf.rc != 0"
  tags:
    - vagrant

- name: install vagrant-berkshelf plugin
  shell: "vagrant plugin install vagrant-berkshelf"
  when: vagrant_berkshelf|failed
  tags:
    - vagrant

- name: verify vagrant-vbguest plugin
  shell: "vagrant plugin list | grep vagrant-vbguest"
  register: vagrant_vbguest
  ignore_errors: yes
  changed_when: "vagrant_vbguest.rc != 0"
  tags:
    - vagrant

- name: install vagrant-vbguest plugin
  shell: "vagrant plugin install vagrant=vbguest"
  when: vagrant_vbguest|failed
  tags:
    - vagrant

