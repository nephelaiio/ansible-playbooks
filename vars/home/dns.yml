---
pdns_url: "https://pdns.{{ base_domain }}"
pdns_api_proto: http
pdns_api_port: 8081

dns_ttl: 3600
dns_master: domainmaster.nephelai.io

dns:
  search_domains:
    - "{{ base_domain }}"
  zones:
    home:
      name: "{{ base_domain }}"
      hostmaster: "master@{{ base_domain }}"
      ns: "{{ groups['pdns'] }}"
      records: "{{ nets.home.reservations.values() | list | map('merge_dicts', {'type': 'A'}) | list }}"
      cnames:
        - host: "assistant.{{ base_domain }}"
          cname: rpig.home.nephelai.io
      foreman_locations:
        - "{{ foreman_locations.home.name }}"
      foreman_organizations:
        - "{{ foreman_organizations.nephelai.name }}"
    emoh:
      name: "{{ nets.home.zone }}"
      hostmaster: master@home.nephelai.io
      ns: "{{ groups['pdns'] }}"
      records: []
      cnames: []
      foreman_locations:
        - "{{ foreman_locations.home.name }}"
      foreman_organizations:
        - "{{ foreman_organizations.nephelai.name }}"
    tnemeganam:
      name: "{{ nets.management.zone }}"
      hostmaster: master@home.nephelai.io
      ns: "{{ groups['pdns'] }}"
      records: []
      cnames: []
      foreman_locations:
        - "{{ foreman_locations.home.name }}"
      foreman_organizations:
        - "{{ foreman_organizations.nephelai.name }}"

pdns:
  config:
    api: yes
    api-key: "{{ pdns_api_key }}"
    webserver: yes
    webserver-address: 127.0.0.1
    webserver-port: "{{ pdns_api_port }}"
    webserver-allow-from: 127.0.0.1
    dnsupdate: no
    master: yes
    setuid: pdns
    setgid: pdns
    slave: no
    local-address: "{{ ansible_host }}:53"
    security-poll-suffix: ''
    default-soa-name: "{{ groups['pdns'] | first | map(attribute='inventory_hostname') }}"
    default-soa-mail: "{{ dns_master }}"
    default-ttl: "{{ dns_ttl }}"
  backends:
    gpgsql:
      user: "{{ pdns_mysql_user }}"
      host: 127.0.0.1
      password: "{{ pdns_mysql_pass }}"
      dbname: pdns
  domains: "{{ dns.zones.values() | list }}"
