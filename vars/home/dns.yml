---
dns:
  search_domains:
    - "{{ base_domain }}"
  zones:
    home:
      name: "{{ base_domain }}"
      hostmaster: "master@{{ base_domain }}"
      ns: "{{ groups['recursors'] }}"
      records: "{{ nets.home.reservations.values() + (hostvars.values() | select('test_property', '.*.' + base_domain, 'inventory_hostname') | map('alias_keys', {'inventory_hostname': 'host', 'ansible_host': 'ip-address' }) | list) }}"
      cnames:
        - ["{{ base_domain }}", rpia.home.nephelai.io]
    emoh:
      name: "{{ nets.home.zone }}"
      hostmaster: master@home.nephelai.io
      ns: "{{ groups['recursors'] }}"
      records: "{{ (nets.home.reservations.values() + (hostvars.values() | select('test_network', nets.home.network + '/' + nets.home.netmask) | map('alias_keys', {'inventory_hostname': 'host', 'ansible_host': 'ip-address' }) | list)) | map('reverse_record') | list }}"
      cnames: []

pdns:
  config:
    dnsupdate: yes
    allow-dnsupdate-from: "{{ (nets.home.network + '/' + nets.home.netmask) | ipaddr('net') }}"
    master: yes
    setuid: pdns
    setgid: pdns
    slave: no
    local-address: "0.0.0.0:53"
    security-poll-suffix: ''
  backends:
    gmysql:
      user: pdns
      host: 127.0.0.1
      password: "{{ passwords.mysql.pdns }}"
      dbname: pdns
  domains: "{{ dns.zones.values() }}"
