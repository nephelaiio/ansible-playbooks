---
- name: Configure ovirt cluster

  hosts: ovirt_engine

  become: yes

  tasks:

    - name: Manage ovirt datacenter
      ovirt_datacenter:
        auth: "{{ ovirt_auth }}"
        name: "{{ ovirt_data_center }}"
        local: yes
      when: ovirt_data_center is defined

    - name: Manage ovirt clusters
      ovirt_cluster:
        auth: "{{ ovirt_auth }}"
        name: "{{ ovirt_cluster }}"
        data_center: "{{ ovirt_data_center }}"
      when:
        - ovirt_data_center is defined
        - ovirt_cluster is defined

    - name: Manage ovirt logical networks
      ovirt_network:
        auth: "{{ ovirt_auth }}"
        data_center: "{{ item.data_center }}"
        name: "{{ item.name }}"
        vlan_tag: "{{ item.vlan_tag }}"
        vm_network: "{{ item.vm_network | default(omit) }}"
        wait: "{{ item.wait | default(omit) }}"
      loop_control:
        label: "{{ item.name }}"
      loop: "{{ ovirt_logical_networks }}"
      when:
        - ovirt_data_center is defined
        - ovirt_logical_networks is defined
