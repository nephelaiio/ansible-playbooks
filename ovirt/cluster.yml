---
- name: Configure ovirt cluster

  hosts: ovirt_engine

  become: yes

  tasks:

    - name: Manage ovirt datacenter
      ovirt_datacenter:
        auth: "{{ ovirt_auth }}"
        name: "{{ ovirt_data_center }}"

    - name: Manage ovirt cluster
      ovirt_cluster:
        auth: "{{ ovirt_auth }}"
        name: "{{ ovirt_cluster }}"
        data_center: Default

    - name: Manage ovirt logical networks
      ovirt_network:
        auth: "{{ ovirt_auth }}"
        data_center: "{{ item.data_center }}"
        name: "{{ item.name }}"
        vlan_tag: "{{ item.vlan_tag }}"
        vm_network: "{{ item.vm_network | default(omit) }}"
        wait: "{{ item.wait | default(omit) }}"
      loop_control:
        label: "{{ item.name }}"
      loop: "{{ ovirt_logical_networks }}"



- name: Configure ovirt cluster

  hosts: ovirt_hosts

  become: yes

  tasks:

    - name: Manage ovirt host networks
      ovirt_host_network:
        auth: "{{ ovirt_auth }}"
        name: "{{ ansible_fqdn }}"
        bond: "{{ ovirt_host_network_bond | default(omit) }}"
        interface: "{{ ovirt_host_network_iface | default(ansible_default_ipv4.interface) }}"
        networks: "{{ ovirt_host_networks }}"
        sync_networks: yes
