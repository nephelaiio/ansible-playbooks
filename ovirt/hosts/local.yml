---
- name: Manage local storage domains

  hosts: ovirt_hosts_local

  become: yes

  serial: 1

  vars:

    ovirt_localfs_path: /var/lib/machines
    ovirt_localiso_path: /var/lib/iso

  tasks:

    - name: Create local storage domain path
      file:
        state: directory
        path: "{{ ovirt_localfs_path }}"
        owner: vdsm
        group: kvm
        mode: 0750

    - name: Manage local storage domain
      ovirt_storage_domain:
        auth: "{{ ovirt_auth }}"
        name: "{{ ovirt_storage_domain }}"
        host: "{{ inventory_hostname }}"
        data_center: "{{ ovirt_data_center }}"
        domain_function: data
        localfs:
          path: "{{ ovirt_localfs_path }}"

    - name: Create local iso path
      file:
        state: directory
        path: "{{ ovirt_localiso_path }}"
        owner: vdsm
        group: kvm
        mode: 0750

    - name: Manage local iso domain
      ovirt_storage_domain:
        auth: "{{ ovirt_auth }}"
        name: "{{ ovirt_iso_domain }}"
        host: "{{ inventory_hostname }}"
        data_center: "{{ ovirt_data_center }}"
        domain_function: iso
        localfs:
          path: "{{ ovirt_localiso_path }}"
