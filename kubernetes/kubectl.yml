---
- name: configure kubectl

  hosts: localhost

  connection: local

  vars:

    kubectl_config: ~/.kube/config
    kubespray_config: ../inventory/artifacts/admin.conf

  tasks:

    - name: create kubectl config directory
      file:
        state: directory
        path: ~/.kube

    - name: check configuration file
      stat:
        path: "{{ kubespray_config }}"
      register: ks_config

    - name: copy kubectl configuration
      copy:
        remote_src: yes
        dest: "{{ kubectl_config }}"
        src: "{{ kubespray_config }}"
      when: ks_config.stat.exists

    - name: destroy config artifact
      file:
        state: absent
        path: "{{ item }}"
      with_items:
        - ../inventory/artifacts
        - ../inventory/credentials
