---
- name: install docker

  hosts: rancher_control

  become: yes

  vars:

    rancher_port: 80
    mysql_data_path: /opt/mysql
    container_name: rancher
    container_image: rancher/rancher:v2.3.5
    service_name: "{{ container_name }}"
    container_volumes:
      - "{{ mysql_data_path }}:/var/lib/mysql"
    container_ports:
      - "{{ rancher_port }}:{{ rancher_port }}"
    consul_service_name: rancher
    consul_service_port: "{{ rancher_port }}"
    consul_service_cname: "traefik.service.consul.{{ base_domain }}."
    consul_service_tags:
      - traefik.protocol=http
      - traefik.frontend.passHostHeader=true
      - traefik.enable=true

  pre_tasks:

    - name: create mysql data path
      file:
        path: "{{ mysql_data_path }}"
        state: directory

  roles:

    - nephelaiio.docker
    - mhutter.docker-systemd-service
    - nephelaiio.consul_service
